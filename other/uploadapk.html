<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>APK Delopy</title>
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/fileinput.css" media="all" rel="stylesheet" type="text/css"/>
    <script src="../js/jquery-2.0.3.min.js"></script>
    <script src="../js/fileinput.js" type="text/javascript"></script>
    <script src="../js/fileinput_locale_uk.js" type="text/javascript"></script>
    <script src="../js/bootstrap.min.js" type="text/javascript"></script>
</head>
<body>
<!-- 导航条 -->
<div class="navbar-wrapper">
    <div class="container">
        <nav class="navbar navbar-inverse navbar-static-top">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                        <span class="sr-only">Toggle navigation
                        </span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../index.html">熊猫信息</a>
                </div>
                <div id="navbar" class="navbar-collapse collapse">
                    <ul class="nav navbar-nav">
                        <li ><a href="../index.html">主页</a></li>
                        <li ><a href="../download.html">下载</a></li>
                        <li><a href="../doc.html">文档</a></li>
                        <li class="dropdown active">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">其他<span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li><a href="manager.html">管理中心</a></li>
                                <li><a href="uploadapk.html">版本发布</a> </li>
                                <li><a href="permission.html">权限问题</a></li>
                                <li role="separator" class="divider"></li>
                                <li class="dropdown-header">熊猫信息</li>
                                <li><a href="version.html">版本信息</a></li>
                                <li><a href="about.html">关于我们</a></li>
                            </ul>
                        </li>
                    </ul>
                    <ul class="nav navbar-nav navbar-right">
                        <li><a href="../login.html">登录</a></li>
                        <li><a href="../regedit.html">注册</a></li>
                        <li><a href="users.html"></a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </div>
</div>

<div class="container kv-main">
    <div class="page-header">
        <h1>熊猫信息APK版本升级
            <small>
        </h1>
        <h3 class="text-success">当前版本:</h3>
    </div>

    <label style="font-size: large">历史版本</label>
    <div class="table-responsive">
        <table id="oldversion" class="table table-striped">
            <tr>
                <th>
                    版本号
                </th>
                <th>
                    版本编码
                </th>
                <th>
                    版本介绍
                </th>
                <th>
                    版本更新时间
                </th>
            </tr>
            <tr>
                <td>
                    V1.0.1.1025_base
                </td>
                <td>
                    2
                </td>
                <td>
                    测试版本发布功能 版本发布
                </td>
                <td>
                    2018年10月25日 12:00:00
                </td>
            </tr>
            <tr>
                <td>
                    V1.0.0.1022_base
                </td>
                <td>
                    1
                </td>
                <td>
                    测试版本发布功能 版本发布
                </td>
                <td>
                    2018年10月22日 12:00:00
                </td>
            </tr>

        </table>
    </div>
    <hr/>
    <label style="font-size: large">新版本发布</label>
    <div class="row">
        <div class="col-lg-8">
            <form action="">
                <div class="form-group">
                    <label for="versionname">版本号：</label>
                    <input type="text" class="form-control" id="versionname" placeholder="${nowversionname}">
                </div>
                <div class="form-group">
                    <label for="versioncode">版本编码</label>
                    <input type="number" class="form-control" id="versioncode" placeholder="${nowversion}">
                </div>
                <div class="form-group">
                    <label for="versiondoc">版本说明</label>
                    <textarea class="form-control" id="versiondoc" rows="5" placeholder="${nowversiondoc}"></textarea>
                </div>
                <div class="form-group">
                    <lable for="uploadapk">apk上传</lable>
                    <input id="uploadapk" class="form-control" disable placeholder="APK文件名">
                    <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">
                        上传APK
                    </button>
                </div>
                <div class="checkbox">
                    <label>
                        <input type="checkbox"> 强制更新
                    </label>
                </div>
                <button type="submit" class="btn btn-default">完成</button>
            </form>
        </div>
    </div>
    <br/>
    <footer>
        <p class="pull-right"><a href="#">回到顶部</a></p>
        <p>&copy; 2018 by Wuang. &middot; <a href="http://www.miitbeian.gov.cn/">豫ICP备18036314号</a> &middot; <a href="#">www.wuang.work</a></p>
    </footer>
</div>


<!-- 上传页面遮罩 -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">上传APK</h4>
            </div>
            <div class="modal-body">
                <form name="Form2" enctype="multipart/form-data">
                    <h4>上传最新版本APK文件</h4>
                    <br/>
                    <input type="file" onchange="filechange()" id="file" >
                    <div id="info">
                        <div id="fileName"></div>
                        <div id="fileSize"></div>
                        <div id="fileType"></div>
                    </div>
                    <br/>
                    <div class="progress">
                        <div id="upload_progress" class="progress-bar" name="upload_progress" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
                            0%
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" id="selectedfile" class="btn btn-default">文件信息</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" id="upload" class="btn btn-primary" >上传</button>
            </div>
        </div>
    </div>
</div>

<!-- 提交页面遮罩 -->
<div class="modal fade" id="submitModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">发布</h4>
            </div>
            <div class="modal-body">
                确认发布？
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" id="deploy" class="btn btn-primary" >发布</button>
            </div>
        </div>
    </div>
</div>

<!-- FOOTER -->

</body>
<script>
    $(function(){
        alert("测试初始化");

    });
    function filechange(){
        //alert("展示文件信息");
        var file = $("#file")[0].files[0];
        if (file) {
            var fileSize = 0;
            if (file.size > 1024 * 1024)
                fileSize = (Math.round(file.size * 100 / (1024 * 1024)) / 100).toString() + 'MB';
            else
                fileSize = (Math.round(file.size * 100 / 1024) / 100).toString() + 'KB';
            $("#fileName").text("文件名："+ file.name);
            $("#fileSize").text("文件大小："+ fileSize);
            $("#fileType").text("文件类型：" + file.type);
        }
    }
    $("#upload").click(function() {
        //alert("开始上传");
        var fd = new FormData();
        fd.append("file",$("#file")[0].files[0]);
        //alert($("#file")[0].files[0].name )
        var xhr = new XMLHttpRequest();
        xhr.upload.addEventListener("progress", uploadProgress, false);
        xhr.addEventListener("load", uploadComplete, false);
        xhr.addEventListener("error", uploadFailed, false);
        xhr.addEventListener("abort", uploadCanceled, false);
        xhr.open("POST", "${pageContext.request.contextPath }/uploadd.do");//修改成自己的接口
        xhr.send(fd);
    });

    function uploadProgress(evt) {
        if (evt.lengthComputable) {
            var percent = Math.round(evt.loaded * 100 / evt.total);
            $("#upload_progress").css("width", percent + "%").text(percent + "%");
        }
        else {
        }
    }
    function uploadComplete(evt) {
        /* 服务器端返回响应时候触发event事件*/
        $("#uploadapk").attr("value",$("#file")[0].files[0].name);
        $('#myModal').modal('hide');
        alert("上传成功");
    }
    function uploadFailed(evt) {
        alert("There was an error attempting to upload the file.");
    }
    function uploadCanceled(evt) {
        alert("The upload has been canceled by the user or the browser dropped the connection.");
    }

</script>
</html>
